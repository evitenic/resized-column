document.addEventListener("alpine:init",()=>{Alpine.data("resizedColumn",function({tableKey:h,columnId:n,cellPrefix:d,minColumnWidth:u,maxColumnWidth:s,sessionBrowser:l=0}){return s=s===-1?1/0:s,{tableWrapper:null,table:null,column:null,minColumnWidth:u,maxColumnWidth:s,handleBar:null,tableWrapperContentSelector:".fi-ta-content",tableSelector:".fi-ta-table",tableBodyCellPrefix:"fi-table-cell-",debounceTime:500,currentWidth:0,originalWidth:0,originalTableWidth:0,originalWrapperWidth:0,init(){if(this.column=this.$el,this.table=this.column.closest(this.tableSelector),this.tableWrapper=this.column.closest(this.tableWrapperContentSelector),!(!this.column||!this.table||!this.tableWrapper))if(this.initializeColumnLayout(),l){let t=this.getSavedWidth();t&&this.applyColumnWidth(t)}else this.setupLivewireUpdates()},initializeColumnLayout(){this.column.classList.add("relative","group/column-resize"),this.createHandleBar()},createHandleBar(){let t=this.column.querySelector(".column-resize-handle-bar");t&&t.remove(),this.handleBar=document.createElement("button"),this.handleBar.type="button",this.handleBar.classList.add("column-resize-handle-bar"),this.handleBar.title="Resize column",this.column.appendChild(this.handleBar),this.handleBar.addEventListener("mousedown",e=>this.startResize(e))},startResize(t){t.preventDefault(),this.handleBar.classList.add("active"),this.originalWidth=Math.round(this.column.offsetWidth),this.originalTableWidth=Math.round(this.table.offsetWidth),this.originalWrapperWidth=Math.round(this.tableWrapper.offsetWidth);let e=t.pageX,i=o=>{if(o.pageX===e)return;let c=o.pageX-e;this.currentWidth=Math.max(this.minColumnWidth,Math.min(this.maxColumnWidth,this.originalWidth+c-16));let r=this.originalTableWidth-this.originalWidth+this.currentWidth;this.table.style.width=r>this.originalWrapperWidth?`${r}px`:"auto",this.applyColumnWidth(this.currentWidth),this.$dispatch("column-resized")},a=()=>{this.handleBar.classList.remove("active"),this.debounce(()=>{l?this.saveWidthToStorage(this.currentWidth):this.$wire.updateColumnWidth(n,this.currentWidth)},this.debounceTime)(),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",a)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",a)},applyColumnWidth(t){this.setColumnStyles(this.column,t);let e=`.${this.escapeCssClass(this.tableBodyCellPrefix+d)}`;this.table.querySelectorAll(e).forEach(i=>{this.setColumnStyles(i,t),i.style.overflow="hidden"})},setColumnStyles(t,e){t.style.width=`${e}px`,t.style.minWidth=`${e}px`,t.style.maxWidth=`${e}px`},escapeCssClass(t){return t.replace(/\./g,"\\.")},debounce(t,e){let i;return(...a)=>{clearTimeout(i),i=setTimeout(()=>{t(...a)},e)}},setupLivewireUpdates(){window.Livewire.hook("morph.updated",()=>{this.initializeColumnLayout()})},getStorageKey(){return`${h}_columnWidth_${n}`},getSavedWidth(){let t=sessionStorage.getItem(this.getStorageKey());return t?parseInt(t):null},saveWidthToStorage(t){try{sessionStorage.setItem(this.getStorageKey(),Math.max(this.minColumnWidth,Math.min(this.maxColumnWidth,t)).toString())}catch(e){console.error("Failed to save column width:",e)}}}})});
