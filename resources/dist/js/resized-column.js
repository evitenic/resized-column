document.addEventListener("alpine:init",()=>{Alpine.data("resizedColumn",function({tableKey:o,columnId:n,cellPrefix:r,minColumnWidth:d,maxColumnWidth:a,sessionBrowser:l=0}){return a=a===-1?1/0:a,{tableWrapper:null,table:null,column:null,minColumnWidth:d,maxColumnWidth:a,handleBar:null,tableWrapperContentSelector:".fi-ta-content",tableSelector:".fi-ta-table",tableBodyCellPrefix:"fi-table-cell-",debounceTime:0,currentWidth:0,originalWidth:0,originalTableWidth:0,originalWrapperWidth:0,init(){this.column=this.$el,this.table=this.column.closest(this.tableSelector),this.tableWrapper=this.column.closest(this.tableWrapperContentSelector),!(!this.column||!this.table||!this.tableWrapper)&&(this.initializeColumnLayout(),this.setupLivewireUpdates())},initializeColumnLayout(){this.column.classList.add("relative","group/column-resize"),this.createHandleBar();let t=this.getSavedWidth();t&&this.applyColumnWidth(t)},createHandleBar(){let t=this.column.querySelector(".column-resize-handle-bar");t&&t.remove(),this.handleBar=document.createElement("button"),this.handleBar.type="button",this.handleBar.classList.add("column-resize-handle-bar"),this.handleBar.title="Resize column",this.column.appendChild(this.handleBar),this.handleBar.addEventListener("mousedown",e=>this.startResize(e)),this.handleBar.addEventListener("dblclick",e=>this.handleDoubleClick(e))},handleDoubleClick(t){t.preventDefault(),t.stopPropagation(),this.applyColumnWidth(this.minColumnWidth),this.handleColumnUpdate(this.minColumnWidth)},startResize(t){t.preventDefault(),this.handleBar.classList.add("active"),this.originalWidth=Math.round(this.column.offsetWidth),this.originalTableWidth=Math.round(this.table.offsetWidth),this.originalWrapperWidth=Math.round(this.tableWrapper.offsetWidth);let e=t.pageX,i=u=>{let m=u.pageX-e;this.currentWidth=Math.max(this.minColumnWidth,Math.min(this.maxColumnWidth,this.originalWidth+m-16));let h=this.originalTableWidth-this.originalWidth+this.currentWidth;this.table.style.width=h>this.originalWrapperWidth?`${h}px`:"auto",this.applyColumnWidth(this.currentWidth),l||this.$dispatch("column-resized")},s=()=>{this.handleBar.classList.remove("active"),this.debounceTime>0?this.debounce(()=>this.handleColumnUpdate(),this.debounceTime)():this.handleColumnUpdate(),document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",s)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",s)},handleColumnUpdate(t=this.currentWidth){l?this.saveWidthToStorage(t):this.$wire.updateColumnWidth(n,t)},applyColumnWidth(t){this.setColumnStyles(this.column,t);let e=`.${this.escapeCssClass(this.tableBodyCellPrefix+r)}`;this.table.querySelectorAll(e).forEach(i=>{this.setColumnStyles(i,t),i.style.overflow="hidden"})},setColumnStyles(t,e,i=this.minColumnWidth,s=this.maxColumnWidth){t.style.width=`${e}px`,t.style.minWidth=`${i}px`,t.style.maxWidth=`${s}px`},escapeCssClass(t){return t.replace(/\./g,"\\.")},debounce(t,e){let i;return(...s)=>{clearTimeout(i),i=setTimeout(()=>{t(...s)},e)}},setupLivewireUpdates(){window.Livewire.hook("morph.updated",()=>{this.initializeColumnLayout()})},getStorageKey(){return`${o}_columnWidth_${n}`},getSavedWidth(){let t=sessionStorage.getItem(this.getStorageKey());return t?parseInt(t):null},saveWidthToStorage(t){try{sessionStorage.setItem(this.getStorageKey(),Math.max(this.minColumnWidth,Math.min(this.maxColumnWidth,t)).toString())}catch(e){console.error("Failed to save column width:",e)}}}})});
