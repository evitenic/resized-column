document.addEventListener("alpine:init",()=>{Alpine.data("resizedColumn",function({tableKey:u,columnId:n,cellName:c,minColumnWidth:m,maxColumnWidth:a,sessionBrowser:l=0}){return a=a===-1?1/0:a,{tableWrapper:null,table:null,column:null,minColumnWidth:m,maxColumnWidth:a,handleBar:null,tableWrapperContentSelector:".fi-ta-content",tableSelector:".fi-ta-table",tableBodyCellPrefix:"fi-table-cell-",debounceTime:0,currentWidth:0,originalWidth:0,originalTableWidth:0,originalWrapperWidth:0,init(){this.column=this.$el,this.table=this.column.closest(this.tableSelector),this.tableWrapper=this.column.closest(this.tableWrapperContentSelector),!(!this.column||!this.table||!this.tableWrapper)&&(this.initializeColumnLayout(),this.setupLivewireUpdates())},initializeColumnLayout(){this.column.classList.add("relative","group/column-resize"),this.createHandleBar();let t=this.getSavedWidth();t&&this.applyColumnWidth(t)},createHandleBar(){let t=this.column.querySelector(".column-resize-handle-bar");t&&t.remove(),this.handleBar=document.createElement("button"),this.handleBar.type="button",this.handleBar.classList.add("column-resize-handle-bar"),this.handleBar.title="Resize column",this.column.appendChild(this.handleBar),this.handleBar.addEventListener("mousedown",e=>this.startResize(e)),this.handleBar.addEventListener("dblclick",e=>this.handleDoubleClick(e))},handleDoubleClick(t){t.preventDefault(),t.stopPropagation(),this.applyColumnWidth(100),this.handleColumnUpdate(100)},startResize(t){t.preventDefault(),this.handleBar.classList.add("active");let e=t.pageX,i=Math.round(this.column.offsetWidth),s=Math.round(this.table.offsetWidth),p=Math.round(this.tableWrapper.offsetWidth),o=r=>{if(r.pageX===e)return;let W=r.pageX-e;this.currentWidth=Math.round(Math.min(this.maxColumnWidth,Math.max(this.minColumnWidth,i+W-16)));let d=s-i+this.currentWidth;this.table.style.width=d>p?`${d}px`:"auto",this.applyColumnWidth(this.currentWidth),l||this.$dispatch("column-resized")},h=()=>{this.handleBar.classList.remove("active"),this.debounceTime>0?this.debounce(()=>this.handleColumnUpdate(),this.debounceTime)():this.handleColumnUpdate(),document.removeEventListener("mousemove",o),document.removeEventListener("mouseup",h)};document.addEventListener("mousemove",o),document.addEventListener("mouseup",h)},handleColumnUpdate(t=this.currentWidth){l?this.saveWidthToStorage(t):this.$wire.updateColumnWidth(n,t)},applyColumnWidth(t){this.setColumnStyles(this.column,t);let e=`.${this.escapeCssClass(this.tableBodyCellPrefix+c)}`;this.table.querySelectorAll(e).forEach(i=>{this.setColumnStyles(i,t),i.style.overflow="hidden"})},setColumnStyles(t,e,i=this.minColumnWidth,s=this.maxColumnWidth){t.style.width=`${e}px`,t.style.minWidth=`${i}px`,t.style.maxWidth=`${s}px`},escapeCssClass(t){return t.replace(/\./g,"\\.")},debounce(t,e){let i;return(...s)=>{clearTimeout(i),i=setTimeout(()=>{t(...s)},e)}},setupLivewireUpdates(){window.Livewire.hook("morph.updated",()=>{this.initializeColumnLayout()})},getStorageKey(){return`${u}_columnWidth_${n}`},getSavedWidth(){let t=sessionStorage.getItem(this.getStorageKey());return t?parseInt(t):null},saveWidthToStorage(t){sessionStorage.setItem(this.getStorageKey(),Math.max(this.minColumnWidth,Math.min(this.maxColumnWidth,t)).toString())}}})});
